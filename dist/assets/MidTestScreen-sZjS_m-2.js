import{aT as se,o as te,f1 as re,dQ as le,q as ie,cH as ae,r as u,aq as Y,f2 as W,e as T,j as t,I as oe,k as ne,eB as ce,dT as de,B as me}from"./index-BomD4pl1.js";import{o as ue}from"./oops-transformed-removebg-preview-BQlOFNcw.js";import{C as fe}from"./CountdownTimer-BAn1h5iR.js";import{a as pe}from"./useQuizHook-C9f4jaC2.js";const ge=()=>{var G,R,H,V,K;const M=se(),{midTestID:y,subjectID:X}=te(),{midTest:s}=re(X);le(y);const{studentInfo:r}=ie(),{performance:C}=pe(r==null?void 0:r._id);ae(r==null?void 0:r.schoolIDs);const[d,Z]=u.useState(((G=JSON.parse(localStorage.getItem("midTest")))==null?void 0:G.state)||{}),[Q,A]=u.useState(!1),[I,O]=u.useState(!1),[q,B]=u.useState(!1),[$,S]=u.useState(!1),_=s==null?void 0:s.subjectID,P=(e,i)=>{Z(o=>({...o,[e]:i.trim()}))},L=e=>e>=0&&e<=5?"This is a very poor result.":e>=6&&e<=11?"This result is poor; it's not satisfactory.":e>=11&&e<=15?"Below average; needs significant improvement.":e>=16&&e<=21?"Below average; more effort required.":e>=21&&e<=25?"Fair but not satisfactory; strive harder.":e>=26&&e<=31?"Fair performance; potential for improvement.":e>=31&&e<=35?"Average; a steady effort is needed.":e>=36&&e<=41?"Average; showing gradual improvement.":e>=41&&e<=45?"Slightly above average; keep it up.":e>=46&&e<=51?"Decent work; shows potential.":e>=51&&e<=55?"Passable; satisfactory effort.":e>=56&&e<=61?"Satisfactory; good progress.":e>=61&&e<=65?"Good work; keep striving for excellence.":e>=66&&e<=71?"Commendable effort; very good.":e>=71&&e<=75?"Very good; consistent effort is visible.":e>=76&&e<=81?"Excellent performance; well done!":e>=81&&e<=85?"Exceptional result; keep up the great work!":e>=86&&e<=91?"Outstanding achievement; impressive work!":e>=91&&e<=95?"Brilliant performance; youâ€™re a star!":e>=96&&e<=100?"Outstanding achievement; impressive work!":"",U=e=>e>=0&&e<=39?"F9":e>=39&&e<=44?"E8":e>=44&&e<=49?"D7":e>=49&&e<=54?"C6":e>=54&&e<=59?"C5":e>=59&&e<=64?"C4":e>=64&&e<=69?"B3":e>=69&&e<=74?"B2":e>=74&&e<=100?"A1":null,a=s==null?void 0:s.quiz,z=(R=C==null?void 0:C.performance)==null?void 0:R.find(e=>(e==null?void 0:e.quizID)===y&&(e==null?void 0:e.quizDone));let E=parseFloat((V=(H=s==null?void 0:s.quiz)==null?void 0:H.instruction)==null?void 0:V.duration)*3600,n=0;const D=()=>{var b,p,N,v,x;O(!0);const e=(p=(b=s==null?void 0:s.quiz)==null?void 0:b.question)==null?void 0:p.map(c=>c.answer.trim());e.forEach((c,m)=>{var j;c===((j=d[m])==null?void 0:j.trim())&&n++});const i=Math.ceil(n/e.length*100);let o=L(i),l=U(i);const f=(v=(N=s==null?void 0:s.quiz)==null?void 0:N.instruction)==null?void 0:v.mark,h=s==null?void 0:s.quiz,J=(x=h==null?void 0:h.question)==null?void 0:x.length;E=0,W(r==null?void 0:r._id,y,_,{studentScore:n,studentGrade:l,remark:o,totalQuestions:J,markPerQuestion:f,status:s.status}).then(c=>{var m;c.status===201?(T.success(`${((m=s==null?void 0:s.status)==null?void 0:m.charAt(0).toUpperCase())+(s==null?void 0:s.status.slice(1))} submitted successfully`),M(`/confirm-quiz-take/${r==null?void 0:r._id}`,{state:{correctAnswers:e,studentAnswers:d,score:n,total:e.length}})):T.error("Something went wrong")}).finally(()=>{O(!1),localStorage.removeItem("countdown"),localStorage.removeItem("midTest"),localStorage.removeItem("midTestQuestions"),S(!1)})},[ee,F]=u.useState(JSON.parse(localStorage.getItem("midTestQuestions")));return JSON.parse(localStorage.getItem("countdown")),u.useEffect(()=>{const e=o=>{var l;(o.ctrlKey&&o.key==="r"||o.key==="F5")&&(o.preventDefault(),T.error(`This action can't be done, while ${((l=s==null?void 0:s.status)==null?void 0:l.charAt(0).toUpperCase())+(s==null?void 0:s.status.slice(1))} is ongoing!`))};window.addEventListener("keydown",e),localStorage.setItem("midTest",JSON.stringify({score:n,state:d}));const i=JSON.parse(localStorage.getItem("midTestQuestions"));if(i===null?(localStorage.setItem("midTestQuestions",JSON.stringify(Y.shuffle(a==null?void 0:a.question))),F(JSON.parse(localStorage.getItem("midTestQuestions")))):(i==null?void 0:i.length)===0&&(localStorage.setItem("midTestQuestions",JSON.stringify(Y.shuffle(a==null?void 0:a.question))),F(JSON.parse(localStorage.getItem("midTestQuestions")))),$){let o=setTimeout(()=>{var v,x,c,m,j;const l=(x=(v=s==null?void 0:s.quiz)==null?void 0:v.question)==null?void 0:x.map(w=>w.answer.trim());l==null||l.forEach((w,k)=>{var g;w===((g=d[k])==null?void 0:g.trim())&&n++});const f=Math.ceil(n/l.length*100);let h=L(f),J=U(f);const b=(m=(c=s==null?void 0:s.quiz)==null?void 0:c.instruction)==null?void 0:m.mark,p=s==null?void 0:s.quiz,N=(j=p==null?void 0:p.question)==null?void 0:j.length;W(r==null?void 0:r._id,y,_,{studentScore:n,studentGrade:J,remark:h,totalQuestions:N,markPerQuestion:b,status:s==null?void 0:s.status}).then(w=>{var k,g;w.status===201?(T.success(`${((k=s==null?void 0:s.status)==null?void 0:k.charAt(0).toUpperCase())+((g=s==null?void 0:s.statu)==null?void 0:g.slice(1))} submitted successfully`),M(`/confirm-quiz-take/${r==null?void 0:r._id}`,{state:{correctAnswers:l,studentAnswers:d,score:n,total:l.length}})):T.error("Something went wrong")}).finally(()=>{O(!1),localStorage.removeItem("countdown"),localStorage.removeItem("midTest"),localStorage.removeItem("midTestQuestions"),S(!1)}),clearTimeout(o)},1e3)}return()=>{window.removeEventListener("keydown",e)}},[d,ee,a,$]),t.jsxs("div",{children:[t.jsx(oe,{position:"top-center",reverseOrder:!0}),t.jsx(ne,{name:`
          ${s==null?void 0:s.subjectTitle} ${s==null?void 0:s.status} Screen`}),z?t.jsxs("div",{className:"flex justify-center items-center flex-col",children:[t.jsx("img",{src:ue,alt:"Oops",className:"w-[250px] h-[250px] object-contain animate-pulse"}),t.jsx("h1",{className:"font-semibold text-purple-700",children:"You have already attempted and Completed this Test"})]}):t.jsxs("div",{className:"relative",children:[!Q&&t.jsxs("div",{className:"absolute top-20 left-1/3 z-10",children:[t.jsx(ce,{size:200,className:"cursor-pointer text-red-500 hover:text-red-600 transition-all duration-300",onClick:()=>{document.startViewTransition?document.startViewTransition(()=>{A(!0),B(!0)}):(A(!0),B(!0))}}),t.jsxs("p",{className:"font-bold",children:["Push Play to start your ",s==null?void 0:s.status]})]}),t.jsx("div",{className:"sticky flex top-[70px] justify-end items-center",children:t.jsxs("div",{className:"sticky min-w-[230px] p-3 bg-blue-50 border shadow-sm rounded-lg flex justify-center items-end flex-col",children:[t.jsxs("h1",{className:"mb-1 text-blue-950 font-semibold flex items-center justify-start gap-2",children:["Test Count Down Timer ",t.jsx(de,{})]}),q&&E?t.jsx("div",{children:t.jsx(fe,{initialSeconds:E,onTimeUp:()=>S(!0)})}):null]})}),t.jsx("div",{className:"bg-slate-50 justify-center flex min-h-[100vh]",children:Q&&t.jsxs("div",{className:"bg-white w-full px-5",children:[(K=a==null?void 0:a.question)==null?void 0:K.map((e,i)=>{var o;return t.jsxs("div",{children:[t.jsxs("p",{className:"text-[14px] font-bold mt-10",children:["Question ",i+1,"."]}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"text-[18px]",children:e==null?void 0:e.question}),t.jsxs("div",{className:"ml-8",children:[t.jsx("p",{className:"text-[12px] mt-5",children:"Choose your options carefully"}),(o=e==null?void 0:e.options)==null?void 0:o.map((l,f)=>t.jsx("div",{children:l!==""&&t.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[t.jsx("input",{className:"radio radio-sm",type:"radio",onChange:()=>{P(i,l)},checked:d[i]===l.trim()}),t.jsx("label",{children:typeof l=="string"?l:JSON.stringify(l)})]},f)}))]})]})]},i)}),t.jsx("div",{className:"border-r mt-10 w-full h-[10px] bg-red-30",children:t.jsx("hr",{})}),t.jsxs("div",{className:"text-[16px] italic font-semibold",children:["Section B"," "]}),t.jsx("div",{className:"mt-5",dangerouslySetInnerHTML:{__html:`${a==null?void 0:a.theory}`}}),t.jsx("div",{children:t.jsx(me,{className:`bg-blue-950 px-12 mt-14 py-4 ${I?"cursor-not-allowed":"cursor-pointer"} `,name:I?"Loading....":"Submit",disabled:I,onClick:D})})]})})]})]})};export{ge as default};
