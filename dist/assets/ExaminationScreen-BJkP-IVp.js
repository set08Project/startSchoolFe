import{aT as H,o as J,dP as Y,q as W,r as c,j as t,I as X,k as Z,eB as z,dT as D,B as q,f5 as ee,e as v}from"./index-BomD4pl1.js";import{o as se}from"./oops-transformed-removebg-preview-BQlOFNcw.js";import{C as te}from"./CountdownTimer-BAn1h5iR.js";import{a as re}from"./useQuizHook-C9f4jaC2.js";const de=()=>{var N,S,k,T;const L=H(),{examID:l}=J(),{examData:e}=Y(l),{studentInfo:i}=W(),{performance:m}=re(i==null?void 0:i._id),[u,U]=c.useState({}),[y,b]=c.useState(!1),[x,w]=c.useState(!1),[B,g]=c.useState(!1),[ne,G]=c.useState(!1),O=e==null?void 0:e.subjectID;console.log(e);const V=(s,r)=>{U(n=>({...n,[s]:r.trim()}))},M=s=>s<=45?"Very poor performance!":s<=55?"A poor performance!":s<=65?"Good performance, can do better!":s<=75?"Good performance, keep it up!":s<=85?"Very good performance!":"Excellent performance!",Q=s=>s<=45?"F":s<=55?"E":s<=65?"D":s<=75?"C":s<=85?"B":"A",f=e==null?void 0:e.quiz,_=(N=m==null?void 0:m.performance)==null?void 0:N.find(s=>(s==null?void 0:s.quizID)===l&&(s==null?void 0:s.quizDone));let p=parseInt((k=(S=e==null?void 0:e.quiz)==null?void 0:S.instruction)==null?void 0:k.duration)*3600;const F=()=>{var C,E,P,A,I;w(!0);const s=(E=(C=e==null?void 0:e.quiz)==null?void 0:C.question)==null?void 0:E.map(a=>a.answer.trim());let r=0;s.forEach((a,d)=>{var $;a===(($=u[d])==null?void 0:$.trim())&&r++});const n=Math.ceil(r/s.length*100);let o=M(n),h=Q(n);const K=(A=(P=e==null?void 0:e.quiz)==null?void 0:P.instruction)==null?void 0:A.mark,j=e==null?void 0:e.quiz,R=(I=j==null?void 0:j.question)==null?void 0:I.length;p=0,ee(i==null?void 0:i._id,l,O,{studentScore:r,studentGrade:h,remark:o,totalQuestions:R,markPerQuestion:K,status:e.status}).then(a=>{var d;a.status===201?(v.success(`${((d=e==null?void 0:e.status)==null?void 0:d.charAt(0).toUpperCase())+(e==null?void 0:e.status.slice(1))} submitted successfully`),L(`/quiz-result/${l}`,{state:{correctAnswers:s,studentAnswers:u,score:r,total:s.length}})):v.error("Something went wrong")}).finally(()=>{w(!1),localStorage.removeItem("countdown")})};return c.useEffect(()=>{const s=r=>{var n;(r.ctrlKey&&r.key==="r"||r.key==="F5")&&(r.preventDefault(),v.error(`This action can't be done, while ${((n=e==null?void 0:e.status)==null?void 0:n.charAt(0).toUpperCase())+(e==null?void 0:e.status.slice(1))} is ongoing!`))};return window.addEventListener("keydown",s),()=>{window.removeEventListener("keydown",s)}},[]),t.jsxs("div",{children:[t.jsx(X,{position:"top-center",reverseOrder:!0}),t.jsx(Z,{name:`${(e==null?void 0:e.term)&&(e==null?void 0:e.term)} ${e==null?void 0:e.subjectTitle} ${e==null?void 0:e.status} Screen`}),_?t.jsxs("div",{className:"flex justify-center items-center flex-col",children:[t.jsx("img",{src:se,alt:"Oops",className:"w-[250px] h-[250px] object-contain animate-pulse"}),t.jsx("h1",{className:"font-semibold text-purple-700",children:"You have already attempted and Completed this Test"})]}):t.jsxs("div",{className:"relative",children:[!y&&t.jsxs("div",{className:"absolute top-20 left-1/3 z-10",children:[t.jsx(z,{size:200,className:"cursor-pointer text-red-500 hover:text-red-600 transition-all duration-300",onClick:()=>{document.startViewTransition?document.startViewTransition(()=>{b(!0),g(!0)}):(b(!0),g(!0))}}),t.jsxs("p",{className:"font-bold",children:["Push Play to start your ",e==null?void 0:e.status]})]}),t.jsx("div",{className:"sticky flex top-[70px] justify-end items-center",children:t.jsxs("div",{className:"sticky min-w-[230px] p-3 bg-blue-50 border shadow-sm rounded-lg flex justify-center items-end flex-col",children:[t.jsxs("h1",{className:"mb-1 text-blue-950 font-semibold flex items-center justify-start gap-2",children:["Test Count Down Timer ",t.jsx(D,{})]}),B&&p?t.jsx("div",{children:t.jsx(te,{initialSeconds:p,onTimeUp:()=>G(!0)})}):null]})}),t.jsx("div",{className:"bg-slate-50 justify-center flex min-h-[100vh]",children:y&&t.jsxs("div",{className:"bg-white w-full px-5",children:[(T=f==null?void 0:f.question)==null?void 0:T.map((s,r)=>{var n;return t.jsxs("div",{children:[t.jsxs("p",{className:"text-[14px] font-bold mt-10",children:["Question ",r+1,"."]}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"text-[18px]",children:s==null?void 0:s.question}),t.jsxs("div",{className:"ml-8",children:[t.jsx("p",{className:"text-[12px] mt-5",children:"Choose your options carefully"}),(n=s==null?void 0:s.options)==null?void 0:n.map((o,h)=>t.jsx("div",{children:o!==""&&t.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[t.jsx("input",{className:"radio radio-sm",type:"radio",onChange:()=>{V(r,o)},checked:u[r]===o.trim()}),t.jsx("label",{children:typeof o=="string"?o:JSON.stringify(o)})]},h)}))]})]})]},r)}),t.jsx("div",{children:t.jsx(q,{className:`bg-blue-950 px-12 mt-14 py-4 ${x?"cursor-not-allowed":"cursor-pointer"} `,name:x?"Loading....":"Submit",disabled:x,onClick:F})})]})})]})]})};export{de as default};
