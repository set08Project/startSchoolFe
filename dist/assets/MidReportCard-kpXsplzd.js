import{aT as k,o as R,c4 as S,bQ as C,ci as $,c5 as g,r as b,j as e,I as A,Q as G,aq as y,cj as E,e as w,Y as T,u as B,c2 as I,cl as F,b0 as _,t as L,B as P,cm as q,z}from"./index-CpMs4x3j.js";import{d as M,C as O}from"./ckeditor-91YSErHy.js";document.title="View Students Grades";const H=({props:s,el:t,gradeMidData:c})=>{var r,l;I(s==null?void 0:s._id);const{schoolInfo:n}=_(s==null?void 0:s.schoolIDs),{state:h}=C();g(h==null?void 0:h._id);let a=(l=(r=c==null?void 0:c.midReportCard.find(m=>{var o,i;return m.classInfo===`${s==null?void 0:s.classAssigned} session: ${(o=n[0])==null?void 0:o.year}(${(i=n[0])==null?void 0:i.presentTerm})`}))==null?void 0:r.result)==null?void 0:l.find(m=>m.subject===(t==null?void 0:t.subjectTitle));return e.jsxs("div",{className:"w-[260px] border-r-2 border-blue-950 ",children:[e.jsx("div",{children:e.jsxs("div",{className:"w-[200px] ",children:[e.jsx("p",{className:"pl-1 font-bold text-[12px]",children:a!=null&&a.subject?a==null?void 0:a.subject:"Have't Entered"}),e.jsxs("div",{className:"pl-1 flex gap-1 mt-2 text-[10px] ",children:[e.jsx("p",{className:"w-[35px] border-r",children:"Score"}),e.jsx("p",{className:"w-[35px] ",children:"Total"}),e.jsx("p",{className:"w-[35px] ",children:"Grade"})]})]})}),e.jsxs("div",{className:"pl-1 flex gap-1 mt-2 text-[12px] ",children:[e.jsx("p",{className:"w-[35px] border-r",children:a!=null&&a.exam?a==null?void 0:a.exam:0}),e.jsx("p",{className:"w-[35px] font-bold border-r",children:a!=null&&a.mark?a==null?void 0:a.mark:0}),e.jsx("p",{className:"w-[35px] font-bold",children:a!=null&&a.grade?a==null?void 0:a.grade:"Nill"})]})]})},Q=({props:s,i:t,Data:c,mutate:n})=>{var j,v;const{classID:h}=R(),{data:a}=B();I(s==null?void 0:s._id);const{gradeMidData:r}=F(s==null?void 0:s._id),{oneClass:l}=S(h),[m,o]=b.useState(!1),{subjectData:i}=g(l==null?void 0:l._id);$(l==null?void 0:l._id);const{schoolInfo:N}=_(s==null?void 0:s.schoolIDs);let d=r==null?void 0:r.midReportCard.find(x=>{var u,f;return x.classInfo===`${s==null?void 0:s.classAssigned} session: ${(u=N[0])==null?void 0:u.year}(${(f=N[0])==null?void 0:f.presentTerm})`});return b.useState(`${d!=null&&d.classTeacherComment?d==null?void 0:d.classTeacherComment:""}`),b.useState(`${d!=null&&d.adminComment?d==null?void 0:d.adminComment:""}`),(j=c==null?void 0:c.find(x=>x.studentName===`${s==null?void 0:s.studentFirstName} ${s==null?void 0:s.studentLastName}`))==null||j.performanceRating,console.log("comment: ",d==null?void 0:d.adminComment),e.jsxs("div",{className:`w-full flex items-center gap-2 text-[12px] font-medium  h-28 px-4 my-2  overflow-hidden ${t%2===0?"bg-slate-50":"bg-white"}`,children:[e.jsx("div",{className:"w-[100px] border-r font-bold",children:t+1}),e.jsx("div",{className:"w-[250px] flex border-r",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("img",{className:" mask mask-squircle w-14 h-14 rounded-md border object-cover",src:s!=null&&s.avatar?s==null?void 0:s.avatar:L}),e.jsxs("div",{className:"w-[180px] ",children:[" ",s==null?void 0:s.studentFirstName," ",s==null?void 0:s.studentLastName]})]})}),e.jsx("div",{className:"w-[100px] border-r",children:e.jsx(Y,{props:s})}),e.jsx("div",{className:`w-[${(i==null?void 0:i.classSubjects.length)*200}px]  border-r items-center flex`,children:e.jsx("div",{className:"flex gap-4 ",children:(v=y.sortBy(i==null?void 0:i.classSubjects,"subjectTitle"))==null?void 0:v.map(x=>e.jsx(H,{props:s,el:x,gradeMidData:r}))})}),e.jsx("div",{className:"w-[100px] border-r ",children:d==null?void 0:d.points}),e.jsx("div",{className:"w-[100px] border-r",children:d==null?void 0:d.grade}),e.jsx("div",{className:"w-[300px] border-r",children:d!=null&&d.classTeacherComment?d==null?void 0:d.classTeacherComment:"No Comment Yet"}),e.jsx("div",{className:"w-[180px] border-r",children:e.jsx(P,{name:d!=null&&d.approve?"Result Approved ":"Approve Result",icon:m&&e.jsx(T,{className:"animate-spin "}),className:`pl-4 py-3 w-[85%]  text-white ${d!=null&&d.approve?"bg-black hover:bg-neutral-800 ":"bg-red-500 hover:bg-red-600 "} transition-all duration-300`,onClick:()=>{o(!0),q(a==null?void 0:a._id,s==null?void 0:s._id,d==null?void 0:d.adminComment).then(x=>{var u,f;x.status===201?(n(),w.success("Report Card Report Noted")):w.error(`${(f=(u=x==null?void 0:x.response)==null?void 0:u.data)==null?void 0:f.message}`)}).finally(()=>{o(!1)})}})}),e.jsx("div",{className:"w-[180px] border-r",children:e.jsx("p",{className:"w-[35px] ",children:d!=null&&d.approve?"Approved":"Not Approved"})})]})},Y=({props:s})=>{var c,n,h,a,r,l,m,o;const{mainStudentAttendance:t}=z(s==null?void 0:s._id);return e.jsx("div",{children:((n=(c=t==null?void 0:t.data)==null?void 0:c.attendance)==null?void 0:n.filter(i=>i.present===!0).length)/((a=(h=t==null?void 0:t.data)==null?void 0:h.attendance)==null?void 0:a.length)*100?e.jsxs("div",{children:[(((l=(r=t==null?void 0:t.data)==null?void 0:r.attendance)==null?void 0:l.filter(i=>i.present===!0).length)/((o=(m=t==null?void 0:t.data)==null?void 0:m.attendance)==null?void 0:o.length)*100).toFixed(2),"%"]}):e.jsx("p",{children:"0%"})})},K=({props:s})=>e.jsx("div",{className:"w-[260px] border-r ",children:e.jsx("p",{children:"Subject Offered"})}),U=()=>{var i,N,d;const s=k(),{classID:t}=R(),{oneClass:c}=S(t);C(c==null?void 0:c.className);const{classStudents:n,mutate:h}=$(c==null?void 0:c._id),{subjectData:a}=g(c==null?void 0:c._id);b.useState([]);const[r,l]=b.useState(""),[m,o]=b.useState(!1);return e.jsxs("div",{className:"",children:[e.jsx(A,{position:"top-center",reverseOrder:!0}),e.jsx("div",{className:"mb-0"}),e.jsx(G,{name:"Admin's Mid-Result Remark and Approval"}),e.jsx("div",{className:"mt-10"}),e.jsx("div",{className:"flex w-full justify-end"}),e.jsxs("div",{className:"py-6 px-2 border rounded-md min-w-[300px] overflow-y-hidden ",children:[e.jsxs("div",{className:"text-[gray] flex  gap-2 text-[12px] font-medium uppercase mb-10 px-4",style:{width:`${1200+(a==null?void 0:a.classSubjects.length)*300}px`},children:[e.jsx("div",{className:"w-[100px] border-r",children:"Sequence"}),e.jsx("div",{className:"w-[250px] border-r",children:"student Info"}),e.jsx("div",{className:"w-[100px] border-r",children:"Student's Attendance Ratio"}),e.jsx("div",{className:`w-[${(a==null?void 0:a.classSubjects.length)*200}px] border-r`,children:e.jsx("div",{className:" flex ",children:e.jsx("div",{className:"flex gap-4",children:(i=y.sortBy(a==null?void 0:a.classSubjects,"subjectTitle"))==null?void 0:i.map(j=>e.jsx(K,{props:j}))})})}),e.jsx("div",{className:"w-[100px] border-r",children:"Total Points"}),e.jsx("div",{className:"w-[100px] border-r",children:"Grade"}),e.jsx("div",{className:"w-[300px] border-r",children:"Class Teacher's Comment"}),e.jsx("div",{className:"w-[180px] border-r",children:"Submit Report"}),e.jsx("div",{className:"w-[180px] border-r",children:e.jsx("p",{className:"w-[35px] ",children:"Approve"})})]}),e.jsx("div",{className:" overflow-hidde",style:{width:`${1200+(a==null?void 0:a.classSubjects.length)*300}px`},children:((N=n==null?void 0:n.students)==null?void 0:N.length)>0?e.jsx("div",{children:(d=n==null?void 0:n.students)==null?void 0:d.map((j,v)=>e.jsx("div",{children:e.jsx(Q,{props:j,i:v,mutate:h})},j))}):e.jsx("div",{children:"No student yet"})})]}),e.jsxs("div",{className:"mt-5",children:[e.jsx("p",{className:"text-blue-800 mt-0 font-[500] text-[30px] capitalize",children:"General Class Remark"}),e.jsx("p",{className:"mt-5 mb-2",children:"Please Give a general class remark to approve this result"}),e.jsx("div",{className:"w-full h-[300px] border rounded-md resize-none p-2",children:e.jsx(M.CKEditor,{editor:O,onChange:(j,v)=>{const x=v.getData();l(x)}})}),r?e.jsx("button",{className:`btn btn-wide ${m?"bg-neutral-800":"bg-blue-950"} text-white mt-3 hover:bg-blue-900`,onClick:()=>{o(!0),E(t,r).then(j=>{j.status===200&&(w.success("Result will be Published in a minute time"),s("/dashboard"))}).finally(()=>{o(!1)})},children:m?e.jsx("p",{children:e.jsx(T,{className:"animate-spin text-[20px]"})}):"Result Approved"}):e.jsx("button",{className:"btn  bg-blue-950 text-white mt-8 hover:bg-blue-900 h-[55px] uppercase",children:"Input Remark and Result Approved"})]})]})};export{U as default};
