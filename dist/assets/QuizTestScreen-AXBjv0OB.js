import{aT as W,o as X,dS as Z,q as z,r as a,j as t,I as D,k as q,eB as ee,dT as se,B as te,c7 as re,fC as ne,e as f}from"./index-CpMs4x3j.js";import{o as oe}from"./oops-transformed-removebg-preview-BQlOFNcw.js";import{C as ie}from"./CountdownTimer-mctXplgS.js";import{a as ce}from"./useQuizHook-Ch9d9tNX.js";const fe=()=>{var b,w,N,S,k,T,C;const B=W(),{quizID:l}=X(),{quizData:e}=Z(l),{studentInfo:i}=z(),{performance:m}=ce(i==null?void 0:i._id),[u,F]=a.useState({}),[h,j]=a.useState(!1),[G,g]=a.useState(!1),[ae,L]=a.useState(!1),[y,v]=a.useState(!1),O=e==null?void 0:e.subjectID,V=(s,r)=>{F(n=>({...n,[s]:r.trim()}))},M=s=>s<=45?"Very poor performance!":s<=55?"A poor performance!":s<=65?"Good performance, can do better!":s<=75?"Good performance, keep it up!":s<=85?"Very good performance!":"Excellent performance!",_=s=>s<=45?"F":s<=55?"E":s<=65?"D":s<=75?"C":s<=85?"B":"A",K=e==null?void 0:e.quiz,R=(b=m==null?void 0:m.performance)==null?void 0:b.find(s=>(s==null?void 0:s.quizID)===l&&(s==null?void 0:s.quizDone));let p=parseFloat((N=(w=e==null?void 0:e.quiz[0])==null?void 0:w.instruction)==null?void 0:N.duration)*3600;console.log((k=(S=e==null?void 0:e.quiz[0])==null?void 0:S.instruction)==null?void 0:k.duration);const H=()=>{var Q,E,P,A,I,U;v(!0);const s=(E=(Q=e==null?void 0:e.quiz[1])==null?void 0:Q.question)==null?void 0:E.map(c=>c.answer.trim());let r=0;s.forEach((c,d)=>{var $;c===(($=u[d])==null?void 0:$.trim())&&r++});const n=Math.ceil(r/s.length*100);let o=M(n),x=_(n);const J=(A=(P=e==null?void 0:e.quiz[0])==null?void 0:P.instruction)==null?void 0:A.mark,Y=(U=(I=(e==null?void 0:e.quiz)[1])==null?void 0:I.question)==null?void 0:U.length;p=0,console.log(e),ne(i==null?void 0:i._id,l,O,{studentScore:r,studentGrade:x,remark:o,totalQuestions:Y,markPerQuestion:J,status:e.status}).then(c=>{var d;console.log(c),c.status===201?(f.success(`${((d=e==null?void 0:e.status)==null?void 0:d.charAt(0).toUpperCase())+(e==null?void 0:e.status.slice(1))} submitted successfully`),B(`/quiz-result/${l}`,{state:{correctAnswers:s,studentAnswers:u,score:r,total:s.length}})):f.error("Something went wrong")}).finally(()=>{v(!1),localStorage.removeItem("countdown")})};return a.useEffect(()=>{const s=r=>{var n;(r.ctrlKey&&r.key==="r"||r.key==="F5")&&(r.preventDefault(),f.error(`This action can't be done, while ${((n=e==null?void 0:e.status)==null?void 0:n.charAt(0).toUpperCase())+(e==null?void 0:e.status.slice(1))} is ongoing!`))};return window.addEventListener("keydown",s),()=>{window.removeEventListener("keydown",s)}},[]),console.log(e),t.jsxs("div",{children:[t.jsx(D,{position:"top-center",reverseOrder:!0}),t.jsx(q,{name:`
        ${e==null?void 0:e.subjectTitle} ${e==null?void 0:e.status} Screen`}),R?t.jsxs("div",{className:"flex justify-center items-center flex-col",children:[t.jsx("img",{src:oe,alt:"Oops",className:"w-[250px] h-[250px] object-contain animate-pulse"}),t.jsx("h1",{className:"font-semibold text-purple-700",children:"You have already attempted and Completed this Test"})]}):t.jsxs("div",{className:"relative",children:[!h&&t.jsxs("div",{className:"absolute top-20 left-1/3 z-10",children:[t.jsx(ee,{size:200,className:"cursor-pointer text-red-500 hover:text-red-600 transition-all duration-300",onClick:()=>{document.startViewTransition?document.startViewTransition(()=>{j(!0),g(!0)}):(j(!0),g(!0))}}),t.jsxs("p",{className:"font-bold",children:["Push Play to start your ",e==null?void 0:e.status]})]}),t.jsx("div",{className:"sticky flex top-[70px] justify-end items-center",children:t.jsxs("div",{className:"sticky min-w-[230px] p-3 bg-blue-50 border shadow-sm rounded-lg flex justify-center items-end flex-col",children:[t.jsxs("h1",{className:"mb-1 text-blue-950 font-semibold flex items-center justify-start gap-2",children:["Test Count Down Timer ",t.jsx(se,{})]}),G&&p?t.jsx("div",{children:t.jsx(ie,{initialSeconds:p,onTimeUp:()=>L(!0)})}):null]})}),t.jsx("div",{className:"bg-slate-50 justify-center flex min-h-[100vh]",children:h&&t.jsxs("div",{className:"bg-white w-full px-5",children:[(C=(T=K[1])==null?void 0:T.question)==null?void 0:C.map((s,r)=>{var n;return t.jsxs("div",{children:[t.jsxs("p",{className:"text-[14px] font-bold mt-10",children:["Question ",r+1,"."]}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"text-[18px]",children:s==null?void 0:s.question}),t.jsxs("div",{className:"ml-8",children:[t.jsx("p",{className:"text-[12px] mt-5",children:"Choose your options carefully"}),(n=s==null?void 0:s.options)==null?void 0:n.map((o,x)=>t.jsx("div",{children:o!==""&&t.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[t.jsx("input",{className:"radio radio-sm",type:"radio",onChange:()=>{V(r,o)},checked:u[r]===o.trim()}),t.jsx("label",{children:typeof o=="string"?o:JSON.stringify(o)})]},x)}))]})]})]},r)}),t.jsx("div",{children:t.jsx(te,{className:"bg-blue-950 px-12 mt-14 py-4 text-[20px]",name:y?"Processing...":"Submit",icon:y&&t.jsx(re,{className:"animate-spin text-[18px]"}),onClick:H})})]})})]})]})};export{fe as default};
