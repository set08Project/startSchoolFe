import{aT as E,o as p,c4 as $,bQ as k,ci as R,c5 as T,r as v,aq as S,c6 as F,x as L,j as e,I as P,Q as G,e as M,Y as V,u as A,c2 as _,b0 as B}from"./index-gGbhD9zv.js";document.title="View Students Grades";const q=({props:t,el:d})=>{var f,c;const{gradeData:o}=_(t==null?void 0:t._id),{data:a}=A(),{schoolInfo:r}=B(t==null?void 0:t.schoolIDs),{classID:m}=p();$(m);const{state:x}=k();T(x==null?void 0:x._id);let s=(c=(f=o==null?void 0:o.reportCard.find(j=>{var b,N;return j.classInfo===`${t==null?void 0:t.classAssigned} session: ${(b=r==null?void 0:r.find(n=>(n==null?void 0:n.year)===(a==null?void 0:a.presentSession)))==null?void 0:b.year}(${(N=r==null?void 0:r.find(n=>(n==null?void 0:n.presentTerm)===(a==null?void 0:a.presentTerm)))==null?void 0:N.presentTerm})`}))==null?void 0:f.result)==null?void 0:c.find(j=>j.subject===(d==null?void 0:d.subjectTitle));return e.jsxs("div",{className:"w-[120px] border-r-2 border-blue-950 ",children:[e.jsx("div",{children:e.jsxs("div",{className:"w-[120px] ",children:[e.jsx("p",{className:"pl-1 font-bold text-[12px] "}),e.jsxs("div",{className:"pl-1 flex gap-1 mt-2 text-[10px] ",children:[e.jsx("p",{className:"w-[30px] border-r",children:"CA"}),e.jsx("p",{className:"w-[35px] border-r",children:"Exam"}),e.jsx("p",{className:"w-[35px] ",children:"Total"})]})]})}),e.jsxs("div",{className:"pl-1 flex gap-1 mt-2 text-[12px] ",children:[e.jsx("p",{className:"w-[30px] border-r",children:isNaN((s==null?void 0:s.test1)+(s==null?void 0:s.test2)+(s==null?void 0:s.test3)+(s==null?void 0:s.test4))?0:(s==null?void 0:s.test1)+(s==null?void 0:s.test2)+(s==null?void 0:s.test3)+(s==null?void 0:s.test4)}),e.jsx("p",{className:"w-[35px] border-r",children:s!=null&&s.exam?s==null?void 0:s.exam:0}),e.jsx("p",{className:"w-[35px] font-bold border-r",children:s!=null&&s.mark?s==null?void 0:s.mark:0})]})]})},C=({props:t,i:d})=>{var b,N,n,i,h;const{classID:o}=p();A();const{gradeData:a}=_(t==null?void 0:t._id),{oneClass:r}=$(o),{subjectData:m}=T(r==null?void 0:r._id);R(r==null?void 0:r._id);const{schoolInfo:x}=B(t==null?void 0:t.schoolIDs);let s=a==null?void 0:a.reportCard.find(l=>{var w,y;return l.classInfo===`${t==null?void 0:t.classAssigned} session: ${(w=x==null?void 0:x.find(g=>g.presentTerm===(r==null?void 0:r.presentTerm)))==null?void 0:w.year}(${(y=x==null?void 0:x.find(g=>g.presentTerm===(r==null?void 0:r.presentTerm)))==null?void 0:y.presentTerm})`});v.useState(`${s!=null&&s.classTeacherComment?s==null?void 0:s.classTeacherComment:""}`);let f=(b=s==null?void 0:s.result)==null?void 0:b.map(l=>l==null?void 0:l.mark).reduce((l,w)=>l+w);const c=f/((N=s==null?void 0:s.result)==null?void 0:N.length),j=c>=0&&c<=39?"F9":c>=39&&c<=44?"E8":c>=44&&c<=49?"D7":c>=49&&c<=54?"C6":c>=54&&c<=59?"C5":c>=59&&c<=64?"C4":c>=64&&c<=69?"B3":c>=69&&c<=74?"B2":c>=74&&c<=100?"A1":null;return e.jsxs("div",{className:`w-full flex items-center gap-2 text-[12px] font-medium  h-28 px-4 my-2  overflow-hidden ${d%2===0?"bg-slate-50":"bg-white"}`,children:[e.jsx("div",{className:"w-[40px] border-r font-bold",children:d+1}),e.jsx("div",{className:"w-[220px] flex border-r",children:e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"w-[220px] break-words ",children:[" ",t==null?void 0:t.studentLastName," ",t==null?void 0:t.studentFirstName]})})}),e.jsx("div",{className:"w-[40px] border-r",children:t==null?void 0:t.gender.charAt(0)}),e.jsx("div",{className:`w-[${(m==null?void 0:m.classSubjects.length)*290}px]  border-r items-center flex`,children:e.jsx("div",{className:"flex gap-4 ",children:(n=S.sortBy(m==null?void 0:m.classSubjects,"subjectTitle"))==null?void 0:n.map(l=>e.jsx(q,{props:t,el:l}))})}),e.jsx("div",{className:"w-[40px] border-r ",children:(i=s==null?void 0:s.result)==null?void 0:i.length}),e.jsx("div",{className:"w-[40px] border-r ",children:f}),e.jsx("div",{className:"w-[60px] border-r ",children:(f/((h=s==null?void 0:s.result)==null?void 0:h.length)).toFixed(2)}),e.jsx("div",{className:"w-[40px] border-r",children:j})]})},O=({props:t})=>e.jsx("div",{className:"w-[120px] border-r h-[150px] flex flex-col relative  justify-start items-start ",children:e.jsx("div",{className:"absolute top-[60%] left-3 transform -translate-x-[90%] -translate-y-[70%] rotate-90 text-start h-[180px] w-[150px] mt-10 break-words text-[14px] font-[500] text-black ",children:t==null?void 0:t.subjectTitle})}),U=()=>{var n;E();const{classID:t}=p(),{oneClass:d}=$(t);k(d==null?void 0:d.className);const{classStudents:o}=R(d==null?void 0:d._id),{subjectData:a}=T(d==null?void 0:d._id);v.useState([]),v.useState(""),v.useState(!1);const r=S.orderBy(o==null?void 0:o.students,[i=>{var l,w,y,g;const h=(w=(l=i==null?void 0:i.gradeData)==null?void 0:l.reportCard)==null?void 0:w.find(u=>u.classInfo===`${i==null?void 0:i.classAssigned} session: ${d==null?void 0:d.presentSession}(${d==null?void 0:d.presentTerm})`);return((g=(y=h==null?void 0:h.result)==null?void 0:y.map(u=>u==null?void 0:u.mark))==null?void 0:g.reduce((u,I)=>u+I,0))||0}],["desc"]),m=v.useRef(null),x=()=>{const i=m.current;if(!i)return;i.querySelectorAll("*").forEach(l=>{window.getComputedStyle(l).color.includes("oklch")&&(l.style.color="#000000")})},{toPDF:s,targetRef:f}=F({filename:`broadsheet-${d==null?void 0:d.className}-${L(Date.now()).format("lll")}.pdf`,page:{orientation:"landscape"}}),[c,j]=v.useState(!1),[b,N]=v.useState(!1);return v.useEffect(()=>{x()},[]),e.jsxs("div",{className:"",children:[e.jsx(P,{position:"top-center",reverseOrder:!0}),e.jsx("div",{className:"mb-0"}),e.jsx(G,{name:"Class Result Broad Sheet"}),e.jsx("div",{className:"mt-10"}),e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx("button",{disabled:c,className:`text-[12px] tracking-widest transistion-all duration-300 hover:bg-red-100 px-8 py-2 rounded-md bg-red-50 ${c&&"cursor-not-allowed bg-red-200 animate-pulse"}`,onClick:()=>{j(!0),N(!0);const i=setTimeout(()=>{s().finally(()=>{j(!1),N(!1),clearTimeout(i),M.success("Result downloaded.")})},2e3)},children:c?e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(V,{className:"animate-spin"}),e.jsx("span",{children:"downloading..."})]}):"Print Result"})}),e.jsx("div",{className:"flex w-full justify-end"}),e.jsxs("div",{ref:f,style:{width:`${b?`${100+(a==null?void 0:a.classSubjects.length)*160}px`:""} `,height:"100%"},className:`py-6 px-2 min-w-[300px]  ${b?"":"border rounded-md overflow-y-hidden"} 
        `,children:[e.jsxs("div",{className:"text-[gray] flex  gap-2 text-[12px] font-medium uppercase mb-10 px-4",style:{width:`${100+(a==null?void 0:a.classSubjects.length)*160}px`},children:[e.jsx("div",{className:"w-[40px] border-r",children:"S/N"}),e.jsx("div",{className:"w-[220px] border-r",children:"student Info"}),e.jsx("div",{className:"w-[40px] border-r",children:"sex"}),e.jsx("div",{className:`w-[${(a==null?void 0:a.classSubjects.length)*290}px] border-r`,children:e.jsx("div",{className:" flex ",children:e.jsx("div",{className:"flex gap-4",children:(n=S.sortBy(a==null?void 0:a.classSubjects,"subjectTitle"))==null?void 0:n.map(i=>e.jsx(O,{props:i}))})})}),e.jsx("div",{className:"w-[40px] border-r h-[150px] flex flex-col relative  justify-start items-start ",children:e.jsx("div",{className:"absolute top-[60%] left-1 transform -translate-x-[100%] -translate-y-[70%] rotate-90 text-start h-[180px] w-[150px] mt-10 break-words ",children:"No. of Subj."})}),e.jsx("div",{className:"w-[40px] border-r h-[150px] flex flex-col relative  justify-start items-start ",children:e.jsx("div",{className:"absolute top-[60%] left-1 transform -translate-x-[100%] -translate-y-[70%] rotate-90 text-start h-[180px] w-[150px] mt-10 break-words ",children:"Total Score"})}),e.jsx("div",{className:"w-[60px] border-r h-[150px] flex flex-col relative  justify-start items-start ",children:e.jsx("div",{className:"absolute top-[60%] left-1 transform -translate-x-[100%] -translate-y-[70%] rotate-90 text-start h-[180px] w-[150px] mt-10 break-words ",children:"Total Points"})}),e.jsx("div",{className:"w-[40px] border-r h-[150px] flex flex-col relative  justify-start items-start ",children:e.jsx("div",{className:"absolute top-[60%] left-1 transform -translate-x-[100%] -translate-y-[70%] rotate-90 text-start h-[180px] w-[150px] mt-10 break-words ",children:"Grade"})})]}),e.jsx("div",{className:" overflow-hidde",style:{width:`${100+(a==null?void 0:a.classSubjects.length)*160}px`},children:(r==null?void 0:r.length)>0?e.jsx("div",{children:r==null?void 0:r.map((i,h)=>e.jsx("div",{children:e.jsx(C,{props:i,i:h})},i))}):e.jsx("div",{children:"No student yet"})})]})]})};export{U as default};
